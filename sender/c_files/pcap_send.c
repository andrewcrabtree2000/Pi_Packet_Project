#include <pcap.h>
#include <pthread.h>
#include <stdio.h>
#include <unistd.h>

#define BUFLEN 64
#define SERVER_IP "10.0.24.243"
#define PORT 7777

static const u_char packet[] = {184, 39, 235, 97, 27, 212, 184, 39, 235, 38, 96, 208, 8, 0, 69, 0, 0, 50, 0, 1, 0, 0, 64, 17, 52, 214, 10, 0, 24, 242, 10, 0, 24, 243, 2, 154, 2, 154, 0, 30, 203, 251, 84, 104, 105, 115, 32, 105, 115, 32, 97, 32, 109, 101, 115, 115, 97, 103, 101, 46, 32, 69, 110, 100};
/*{184, 39, 235, 97, 27, 212, 184, 39, 235, 38, 96, 208, 8, 0, 69, 0, 0, 80, 0
, 1, 0, 0, 64, 17, 52, 184, 10, 0, 24, 242, 10, 0, 24, 243, 30, 97, 30, 97, 0,
 60, 75, 67, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108
, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101,
 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87,
 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72
, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32,
 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100,
 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111,
 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108,
 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 
111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114,
 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108,
 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111,
 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101,
 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87,
 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72
, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32,
 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100,
 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111,
 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108,
 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108,
 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 
108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 
108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 
108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87,
 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100,
 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108,
 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114,
 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 
108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114,
 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108,
 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 
108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 
111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 
101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 
87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 
72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 
32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 
100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108,
 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 
108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 
108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 
108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 
111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101
, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111,
 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108,
 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114,
 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108,
 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108,
 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 
32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 
101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 
111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 
72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 
111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 
108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108,
 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32
, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101
, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114,
 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 
32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72,
 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87,
 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108,
 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108,
 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 
87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 
108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 
108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 
32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 
101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 
114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 
111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 
72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 
111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 
108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 
100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 
87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 
108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 
108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111,
 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72,
 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100};
*/

char pcap_errbuf[PCAP_ERRBUF_SIZE] = {'\0'};
pcap_t *pcap;

void * send_packets(void * not_used) {
   while(!pcap_inject(pcap, packet, sizeof(packet)/sizeof(*packet)));// != -1); 
}

int main(void) {
   pcap = pcap_open_live("eth0", 96, 0, 0, pcap_errbuf);
   if(*pcap_errbuf) {
      fprintf(stderr, "%s", pcap_errbuf);
   }
   if(!pcap) {
      return -1;
   }

   //const u_char packet[] = {69, 0, 0, 40, 0, 1, 0, 0, 64, 17, 52, 224, 10, 0, 24, 242, 10, 0, 24, 243, 30, 97, 30, 97, 0, 20, 43, 48, 72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100, 33};
//{184, 39, 235, 38, 96, 208, 184, 39, 235, 97, 27, 212, 8, 0, 69, 0, 0, 28, 0, 1, 0, 0, 64, 17, 52, 236, 10, 0, 24, 242, 10, 0, 24, 243, 30, 97, 30, 97, 0, 8, 125, 55};

   //pthread_t one, two;
   //pthread_create(&one, NULL, send_packets, NULL);
   //pthread_create(&two, NULL, send_packets, NULL);
   send_packets(NULL);
   pcap_close(pcap);
}
